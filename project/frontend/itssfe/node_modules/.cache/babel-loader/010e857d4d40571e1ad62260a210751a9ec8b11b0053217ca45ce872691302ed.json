{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst publish_1 = __importDefault(require(\"./publish\"));\nconst auth_1 = __importDefault(require(\"./auth\"));\nconst connack_1 = __importDefault(require(\"./connack\"));\nconst ack_1 = __importDefault(require(\"./ack\"));\nconst pubrel_1 = __importDefault(require(\"./pubrel\"));\nconst handle = (client, packet, done) => {\n  const {\n    options\n  } = client;\n  if (options.protocolVersion === 5 && options.properties && options.properties.maximumPacketSize && options.properties.maximumPacketSize < packet.length) {\n    client.emit('error', new Error(`exceeding packets size ${packet.cmd}`));\n    client.end({\n      reasonCode: 149,\n      properties: {\n        reasonString: 'Maximum packet size was exceeded'\n      }\n    });\n    return client;\n  }\n  client.log('_handlePacket :: emitting packetreceive');\n  client.emit('packetreceive', packet);\n  switch (packet.cmd) {\n    case 'publish':\n      (0, publish_1.default)(client, packet, done);\n      break;\n    case 'puback':\n    case 'pubrec':\n    case 'pubcomp':\n    case 'suback':\n    case 'unsuback':\n      client.reschedulePing();\n      (0, ack_1.default)(client, packet);\n      done();\n      break;\n    case 'pubrel':\n      client.reschedulePing();\n      (0, pubrel_1.default)(client, packet, done);\n      break;\n    case 'connack':\n      (0, connack_1.default)(client, packet);\n      done();\n      break;\n    case 'auth':\n      client.reschedulePing();\n      (0, auth_1.default)(client, packet);\n      done();\n      break;\n    case 'pingresp':\n      client.log('_handlePacket :: received pingresp');\n      client.reschedulePing();\n      done();\n      break;\n    case 'disconnect':\n      client.emit('disconnect', packet);\n      done();\n      break;\n    default:\n      client.log('_handlePacket :: unknown command');\n      done();\n      break;\n  }\n};\nexports.default = handle;","map":{"version":3,"names":["publish_1","__importDefault","require","auth_1","connack_1","ack_1","pubrel_1","handle","client","packet","done","options","protocolVersion","properties","maximumPacketSize","length","emit","Error","cmd","end","reasonCode","reasonString","log","default","reschedulePing","exports"],"sources":["C:\\Users\\vuhuy\\OneDrive - Hanoi University of Science and Technology\\NEWCODE\\ITSS_JP_2\\node_modules\\mqtt\\src\\lib\\handlers\\index.ts"],"sourcesContent":["import handlePublish from './publish'\r\nimport handleAuth from './auth'\r\nimport handleConnack from './connack'\r\nimport handleAck from './ack'\r\nimport handlePubrel from './pubrel'\r\nimport { PacketHandler } from '../shared'\r\n\r\nconst handle: PacketHandler = (client, packet, done) => {\r\n\tconst { options } = client\r\n\r\n\tif (\r\n\t\toptions.protocolVersion === 5 &&\r\n\t\toptions.properties &&\r\n\t\toptions.properties.maximumPacketSize &&\r\n\t\toptions.properties.maximumPacketSize < packet.length\r\n\t) {\r\n\t\tclient.emit('error', new Error(`exceeding packets size ${packet.cmd}`))\r\n\t\tclient.end({\r\n\t\t\treasonCode: 149,\r\n\t\t\tproperties: { reasonString: 'Maximum packet size was exceeded' },\r\n\t\t})\r\n\t\treturn client\r\n\t}\r\n\r\n\tclient.log('_handlePacket :: emitting packetreceive')\r\n\tclient.emit('packetreceive', packet)\r\n\r\n\tswitch (packet.cmd) {\r\n\t\tcase 'publish':\r\n\t\t\t// DO NOT SHIFT PING HERE, this would lead to https://github.com/mqttjs/MQTT.js/issues/1861\r\n\t\t\thandlePublish(client, packet, done)\r\n\t\t\tbreak\r\n\t\tcase 'puback':\r\n\t\tcase 'pubrec':\r\n\t\tcase 'pubcomp':\r\n\t\tcase 'suback':\r\n\t\tcase 'unsuback':\r\n\t\t\tclient.reschedulePing()\r\n\t\t\thandleAck(client, packet)\r\n\t\t\tdone()\r\n\t\t\tbreak\r\n\t\tcase 'pubrel':\r\n\t\t\tclient.reschedulePing()\r\n\t\t\thandlePubrel(client, packet, done)\r\n\t\t\tbreak\r\n\t\tcase 'connack':\r\n\t\t\t// no need to reschedule ping here as keepalive manager is created after successll connect\r\n\t\t\t// (when onConnect is called at the end of handleConnack)\r\n\t\t\thandleConnack(client, packet)\r\n\t\t\tdone()\r\n\t\t\tbreak\r\n\t\tcase 'auth':\r\n\t\t\tclient.reschedulePing()\r\n\t\t\thandleAuth(client, packet)\r\n\t\t\tdone()\r\n\t\t\tbreak\r\n\t\tcase 'pingresp':\r\n\t\t\tclient.log('_handlePacket :: received pingresp')\r\n\t\t\tclient.reschedulePing()\r\n\t\t\tdone()\r\n\t\t\tbreak\r\n\t\tcase 'disconnect':\r\n\t\t\tclient.emit('disconnect', packet)\r\n\t\t\tdone()\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\t// TODO: unknown packet received. Should we emit an error?\r\n\t\t\tclient.log('_handlePacket :: unknown command')\r\n\t\t\tdone()\r\n\t\t\tbreak\r\n\t}\r\n}\r\n\r\nexport default handle\r\n"],"mappings":";;;;;;;;;;AAAA,MAAAA,SAAA,GAAAC,eAAA,CAAAC,OAAA;AACA,MAAAC,MAAA,GAAAF,eAAA,CAAAC,OAAA;AACA,MAAAE,SAAA,GAAAH,eAAA,CAAAC,OAAA;AACA,MAAAG,KAAA,GAAAJ,eAAA,CAAAC,OAAA;AACA,MAAAI,QAAA,GAAAL,eAAA,CAAAC,OAAA;AAGA,MAAMK,MAAM,GAAkBA,CAACC,MAAM,EAAEC,MAAM,EAAEC,IAAI,KAAI;EACtD,MAAM;IAAEC;EAAO,CAAE,GAAGH,MAAM;EAE1B,IACCG,OAAO,CAACC,eAAe,KAAK,CAAC,IAC7BD,OAAO,CAACE,UAAU,IAClBF,OAAO,CAACE,UAAU,CAACC,iBAAiB,IACpCH,OAAO,CAACE,UAAU,CAACC,iBAAiB,GAAGL,MAAM,CAACM,MAAM,EACnD;IACDP,MAAM,CAACQ,IAAI,CAAC,OAAO,EAAE,IAAIC,KAAK,CAAC,0BAA0BR,MAAM,CAACS,GAAG,EAAE,CAAC,CAAC;IACvEV,MAAM,CAACW,GAAG,CAAC;MACVC,UAAU,EAAE,GAAG;MACfP,UAAU,EAAE;QAAEQ,YAAY,EAAE;MAAkC;KAC9D,CAAC;IACF,OAAOb,MAAM;;EAGdA,MAAM,CAACc,GAAG,CAAC,yCAAyC,CAAC;EACrDd,MAAM,CAACQ,IAAI,CAAC,eAAe,EAAEP,MAAM,CAAC;EAEpC,QAAQA,MAAM,CAACS,GAAG;IACjB,KAAK,SAAS;MAEb,IAAAlB,SAAA,CAAAuB,OAAa,EAACf,MAAM,EAAEC,MAAM,EAAEC,IAAI,CAAC;MACnC;IACD,KAAK,QAAQ;IACb,KAAK,QAAQ;IACb,KAAK,SAAS;IACd,KAAK,QAAQ;IACb,KAAK,UAAU;MACdF,MAAM,CAACgB,cAAc,EAAE;MACvB,IAAAnB,KAAA,CAAAkB,OAAS,EAACf,MAAM,EAAEC,MAAM,CAAC;MACzBC,IAAI,EAAE;MACN;IACD,KAAK,QAAQ;MACZF,MAAM,CAACgB,cAAc,EAAE;MACvB,IAAAlB,QAAA,CAAAiB,OAAY,EAACf,MAAM,EAAEC,MAAM,EAAEC,IAAI,CAAC;MAClC;IACD,KAAK,SAAS;MAGb,IAAAN,SAAA,CAAAmB,OAAa,EAACf,MAAM,EAAEC,MAAM,CAAC;MAC7BC,IAAI,EAAE;MACN;IACD,KAAK,MAAM;MACVF,MAAM,CAACgB,cAAc,EAAE;MACvB,IAAArB,MAAA,CAAAoB,OAAU,EAACf,MAAM,EAAEC,MAAM,CAAC;MAC1BC,IAAI,EAAE;MACN;IACD,KAAK,UAAU;MACdF,MAAM,CAACc,GAAG,CAAC,oCAAoC,CAAC;MAChDd,MAAM,CAACgB,cAAc,EAAE;MACvBd,IAAI,EAAE;MACN;IACD,KAAK,YAAY;MAChBF,MAAM,CAACQ,IAAI,CAAC,YAAY,EAAEP,MAAM,CAAC;MACjCC,IAAI,EAAE;MACN;IACD;MAECF,MAAM,CAACc,GAAG,CAAC,kCAAkC,CAAC;MAC9CZ,IAAI,EAAE;MACN;;AAEH,CAAC;AAEDe,OAAA,CAAAF,OAAA,GAAehB,MAAM","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}