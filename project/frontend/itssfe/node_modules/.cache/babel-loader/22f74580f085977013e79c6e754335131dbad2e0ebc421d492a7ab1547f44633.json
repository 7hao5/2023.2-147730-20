{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst shared_1 = require(\"../shared\");\nconst ack_1 = require(\"./ack\");\nconst handleAuth = (client, packet) => {\n  const {\n    options\n  } = client;\n  const version = options.protocolVersion;\n  const rc = version === 5 ? packet.reasonCode : packet.returnCode;\n  if (version !== 5) {\n    const err = new shared_1.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${version}`, rc);\n    client.emit('error', err);\n    return;\n  }\n  client.handleAuth(packet, (err, packet2) => {\n    if (err) {\n      client.emit('error', err);\n      return;\n    }\n    if (rc === 24) {\n      client.reconnecting = false;\n      client['_sendPacket'](packet2);\n    } else {\n      const error = new shared_1.ErrorWithReasonCode(`Connection refused: ${ack_1.ReasonCodes[rc]}`, rc);\n      client.emit('error', error);\n    }\n  });\n};\nexports.default = handleAuth;","map":{"version":3,"names":["shared_1","require","ack_1","handleAuth","client","packet","options","version","protocolVersion","rc","reasonCode","returnCode","err","ErrorWithReasonCode","emit","packet2","reconnecting","error","ReasonCodes","exports","default"],"sources":["C:\\Users\\vuhuy\\OneDrive - Hanoi University of Science and Technology\\NEWCODE\\ITSS_JP_2\\node_modules\\mqtt\\src\\lib\\handlers\\auth.ts"],"sourcesContent":["import { IAuthPacket } from 'mqtt-packet'\r\nimport { ErrorWithReasonCode, PacketHandler } from '../shared'\r\nimport { ReasonCodes } from './ack'\r\n\r\nconst handleAuth: PacketHandler = (\r\n\tclient,\r\n\tpacket: IAuthPacket & { returnCode: number },\r\n) => {\r\n\tconst { options } = client\r\n\tconst version = options.protocolVersion\r\n\tconst rc = version === 5 ? packet.reasonCode : packet.returnCode\r\n\r\n\tif (version !== 5) {\r\n\t\tconst err = new ErrorWithReasonCode(\r\n\t\t\t`Protocol error: Auth packets are only supported in MQTT 5. Your version:${version}`,\r\n\t\t\trc,\r\n\t\t)\r\n\t\tclient.emit('error', err)\r\n\t\treturn\r\n\t}\r\n\r\n\tclient.handleAuth(\r\n\t\tpacket,\r\n\t\t(err: ErrorWithReasonCode, packet2: IAuthPacket) => {\r\n\t\t\tif (err) {\r\n\t\t\t\tclient.emit('error', err)\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (rc === 24) {\r\n\t\t\t\tclient.reconnecting = false\r\n\t\t\t\tclient['_sendPacket'](packet2)\r\n\t\t\t} else {\r\n\t\t\t\tconst error = new ErrorWithReasonCode(\r\n\t\t\t\t\t`Connection refused: ${ReasonCodes[rc]}`,\r\n\t\t\t\t\trc,\r\n\t\t\t\t)\r\n\t\t\t\tclient.emit('error', error)\r\n\t\t\t}\r\n\t\t},\r\n\t)\r\n}\r\n\r\nexport default handleAuth\r\n"],"mappings":";;;;;AACA,MAAAA,QAAA,GAAAC,OAAA;AACA,MAAAC,KAAA,GAAAD,OAAA;AAEA,MAAME,UAAU,GAAkBA,CACjCC,MAAM,EACNC,MAA4C,KACzC;EACH,MAAM;IAAEC;EAAO,CAAE,GAAGF,MAAM;EAC1B,MAAMG,OAAO,GAAGD,OAAO,CAACE,eAAe;EACvC,MAAMC,EAAE,GAAGF,OAAO,KAAK,CAAC,GAAGF,MAAM,CAACK,UAAU,GAAGL,MAAM,CAACM,UAAU;EAEhE,IAAIJ,OAAO,KAAK,CAAC,EAAE;IAClB,MAAMK,GAAG,GAAG,IAAIZ,QAAA,CAAAa,mBAAmB,CAClC,2EAA2EN,OAAO,EAAE,EACpFE,EAAE,CACF;IACDL,MAAM,CAACU,IAAI,CAAC,OAAO,EAAEF,GAAG,CAAC;IACzB;;EAGDR,MAAM,CAACD,UAAU,CAChBE,MAAM,EACN,CAACO,GAAwB,EAAEG,OAAoB,KAAI;IAClD,IAAIH,GAAG,EAAE;MACRR,MAAM,CAACU,IAAI,CAAC,OAAO,EAAEF,GAAG,CAAC;MACzB;;IAGD,IAAIH,EAAE,KAAK,EAAE,EAAE;MACdL,MAAM,CAACY,YAAY,GAAG,KAAK;MAC3BZ,MAAM,CAAC,aAAa,CAAC,CAACW,OAAO,CAAC;KAC9B,MAAM;MACN,MAAME,KAAK,GAAG,IAAIjB,QAAA,CAAAa,mBAAmB,CACpC,uBAAuBX,KAAA,CAAAgB,WAAW,CAACT,EAAE,CAAC,EAAE,EACxCA,EAAE,CACF;MACDL,MAAM,CAACU,IAAI,CAAC,OAAO,EAAEG,KAAK,CAAC;;EAE7B,CAAC,CACD;AACF,CAAC;AAEDE,OAAA,CAAAC,OAAA,GAAejB,UAAU","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}